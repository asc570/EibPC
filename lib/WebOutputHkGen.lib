// WebOutHkGen() shows Hk Parameters via a Weboutput()
//
// input:
// - HkName:      Name of the Hk as shown in the WebOutput()
// - ID:          the WebOutput(ID)[]
// - GA_Vl        GA of Vorlauf Temp
// - GA_Rl        Ga of Ruecklauf Temp
// - GA_HkModeReq Requested Hk Mode in UVR1611 u16
// - Ga_HkModeAct Actuel Hk Mode in UVR1611 u16
// - GA_PID       Burner PID in 16u
// - GA_bPump     Pump Status (running?) b1
// - GA_wbFrost    Warning: Frost b1
// - GA_bGenHzON   Heatingting system general status ON/OFF

:begin SpWebOutHkGen( HkName,Id,GaVl,GaRl,GaHkModeReq,GA_HkModeAct,GaPID,GabPump,GawbFrost, GabGenHzON )
//
// HTML style color strings
//
:var strColorBase@
strColorBase@ = $black$

:var strColorUnused@
strColorUnused@ = $grey$

:var strColorNormal@
strColorNormal@ = $green$
:var strColorCaution@ 
strColorCaution@ = $DarkOrange$
:var strColorWarning@
strColorWarning@ = $red$

:var strND@
strND@ = $ND$

:var strON@
strON@   = $ON$

:var strOFF@
strOFF@  = $OFF$

:var strTitle@
strTitle@ = HkName

:var strPump@
strPump@  = $?$


:var html@
html@ = $?$c16000

:var style1@
style1@ = $?$c16000


:var style2@
style2@ = $?$c16000


:var STARTDELAY@
STARTDELAY@    = 2000u64


:var strTemp@
strTemp@ = $nil$
////////////////////////////////////////

:var strColorHkStatus@
strColorHkStatus@ = strColorUnused@
:var strHkStatus@
strHkStatus@ = strND@

:var strColorVLRL@
strColorVLRL@ = strColorUnused@
:var fMaxTempDiff@
fMaxTempDiff@ = 5f16



:var iDelay@
iDelay@ = 1
if( after(systemstart(), STARTDELAY@) or cycle(iDelay@,0 ))then{

  if GabGenHzON then{
		strColorHkStatus@ = strColorNormal@;
		strHkStatus@      = strON@;      
		}endif ;
	if(!GabGenHzON) then{
	    strColorHkStatus@ = strColorUnused@;
	    strHkStatus@      = strOFF@;
	    }endif;



   strTemp@ =  stringformat(convert( GaVl,0f16 ) ,4,3,2,0 ) + $C/$ +    \\
               stringformat(convert( GaRl,0f16 ) ,4,3,2,0 ) + $C$ ;

   strColorVLRL@ = strColorNormal@;
   if( convert(GaVl,0f16) - convert( GaRl,0f16 ) >  fMaxTempDiff@ ) then{
      strColorVLRL@ = strColorCaution@;
      }endif;
    

   if GabPump then{
      strPump@=   strON@ 
      }endif ;
  if !GabPump then{
      strPump@ =  strOFF@ 
      }endif ;

//  strTemp@ = $Vl:$+ stringformat( GaVl /148u16 , 0,3,3,3)+$C / Rl:$ + stringformat( GaRl /148u16 , 0,3,3,3)+$C$;

style1@ =  $<style  >                                                 
    body    { font-size: 15px; }                                      
    .head   { margin:0 0 0 0;  }                                      
    .line   { display:flex; width:100%; align-content: space-between;}
    .col1   { flex: 0 0 6em; background-color: lightgrey;}                                  
    .col2   { flex: 0 0 10em; background-color: lightgrey;}                                  
    .col3   { flex: 0 0 6em; background-color: lightgrey;}                                   
    .col4   { flex: 0 0 7em; background-color: lightgrey;   }                               
    .col5   { flex: 0 0 7em; background-color: lightgrey;   }       
    $;                                    
                                          

style2@ = $                                          
    #Hz     { background-color : lightgrey; font-wieght : bold; }    
    #Status { color : black;}                                         
    #VlRl   { color : black   ; font-weight : bold; }                                  
    #Tsoll  { color : black   ; font-weight : bold;}                             
    #PID    { color : black   ; font-weight : bold;}                             
    #Mode   { color : black   ; font-weight :bold; }                             
    #OverTemp{ color : red    ; font-weight :bold; }                             
    #Pump   { color : black   ;                    }                             
    #Frost  { color : red     ; font-weight : bold }                         
   </style>                                          
   $;

html@ = $<h3 id = 'Hz' class= 'head'  >FBH EG</h2>                
    <div id= vlrl  class= line >  	                             
        <div id =  Status  class= col1 >HK: <span style='color:$+ strColorHkStatus@ +$'>
        $+ strHkStatus@ +$</span></div>                
        <div id =  VlRl  class =  col2 >VL/RL: <span style= 'color:$+ strColorVLRL@ +$' >
        $+ strTemp@ +$</span></div>                           
        <div id= Tsoll  class =  col3  > 27C         </div>                            
         <div class =  col4  id= PID   > 21%         </div>                            
    </div>                                                    
    <div class =  line >                                      
        <div id =  Mode  class =  col1  > HIGH        </div>                            
        <div id =  OverTemp class = col2> OverTemp    </div>                            
        <div id =  Pump  class =  col3  > Pump        </div>                            
        <div id =  Frost  class =  col4 > Frost       </div>                            
    </div>                                                    
    $;
 
 
 
   weboutput( Id,style1@+style2@+html@ );

 }endif
:end
